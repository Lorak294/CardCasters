import{s as ue,f as v,a as D,l as pe,g as _,h as L,c as w,m as ve,d as y,j as a,k as re,i as Y,C as i,K as ne,n as _e,y as $,L as me,M as he,B as x,N as ie,p as oe,I as ge,O as be}from"../chunks/scheduler.9428e398.js";import{S as fe,i as ce,f as ye,b as Ee,d as Ie,m as Ce,a as Ue,t as ke,e as De}from"../chunks/index.b8fe6288.js";import{e as Le}from"../chunks/forms.d95c3e1b.js";function we(l){let e,t="No image";return{c(){e=v("div"),e.textContent=t,this.h()},l(s){e=_(s,"DIV",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-sar8fg"&&(e.textContent=t),this.h()},h(){a(e,"class","avatar no-image center svelte-bzj09f")},m(s,f){Y(s,e,f)},p:$,d(s){s&&y(e)}}}function Ne(l){let e,t,s;return{c(){e=v("img"),this.h()},l(f){e=_(f,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){ie(e.src,t=l[1])||a(e,"src",t),a(e,"alt",s=l[1]?"Avatar":"No image"),a(e,"class","avatar image svelte-bzj09f")},m(f,n){Y(f,e,n)},p(f,n){n&2&&!ie(e.src,t=f[1])&&a(e,"src",t),n&2&&s!==(s=f[1]?"Avatar":"No image")&&a(e,"alt",s)},d(f){f&&y(e)}}}function Pe(l){let e,t,s,f,n,d,o=l[2]?"Uploading ...":"Upload",E,I,u,b,c;function C(m,h){return m[1]?Ne:we}let U=C(l),r=U(l);return{c(){e=v("div"),r.c(),t=D(),s=v("input"),f=D(),n=v("div"),d=v("label"),E=pe(o),I=D(),u=v("input"),this.h()},l(m){e=_(m,"DIV",{class:!0});var h=L(e);r.l(h),t=w(h),s=_(h,"INPUT",{type:!0,name:!0}),f=w(h),n=_(h,"DIV",{class:!0});var k=L(n);d=_(k,"LABEL",{class:!0,for:!0});var N=L(d);E=ve(N,o),N.forEach(y),I=w(k),u=_(k,"INPUT",{style:!0,type:!0,id:!0,accept:!0}),k.forEach(y),h.forEach(y),this.h()},h(){a(s,"type","hidden"),a(s,"name","avatar_url"),s.value=l[0],a(d,"class","button primary block"),a(d,"for","single"),re(u,"visibility","hidden"),re(u,"position","absolute"),a(u,"type","file"),a(u,"id","single"),a(u,"accept","image/*"),u.disabled=l[2],a(n,"class","center svelte-bzj09f"),a(e,"class","center svelte-bzj09f")},m(m,h){Y(m,e,h),r.m(e,null),i(e,t),i(e,s),i(e,f),i(e,n),i(n,d),i(d,E),i(n,I),i(n,u),b||(c=[ne(u,"change",l[6]),ne(u,"change",l[4])],b=!0)},p(m,[h]){U===(U=C(m))&&r?r.p(m,h):(r.d(1),r=U(m),r&&(r.c(),r.m(e,t))),h&1&&(s.value=m[0]),h&4&&o!==(o=m[2]?"Uploading ...":"Upload")&&_e(E,o),h&4&&(u.disabled=m[2])},i:$,o:$,d(m){m&&y(e),r.d(),b=!1,me(c)}}}function Ve(l,e,t){let{url:s}=e,{supabase:f}=e,n=null,d=!1,o;const E=he(),I=async c=>{try{const{data:C}=await f.storage.from("avatars").getPublicUrl(c);t(1,n=C.publicUrl)}catch(C){C instanceof Error&&console.error("Error downloading image: ",C.message)}},u=async()=>{try{if(t(2,d=!0),!o||o.length===0)throw new Error("You must select an image to upload.");const c=o[0],C=c.name.split(".").pop(),U=`${Math.random()}.${C}`;let{error:r}=await f.storage.from("avatars").upload(U,c);if(r)throw r;t(0,s=U),setTimeout(()=>{E("upload")},100)}catch(c){c instanceof Error&&alert(c.message)}finally{t(2,d=!1)}};function b(){o=this.files,t(3,o)}return l.$$set=c=>{"url"in c&&t(0,s=c.url),"supabase"in c&&t(5,f=c.supabase)},l.$$.update=()=>{l.$$.dirty&1&&s&&I(s)},[s,n,d,o,u,f,b]}class Ae extends fe{constructor(e){super(),ce(this,e,Ve,Pe,ue,{url:0,supabase:5})}}function Te(l){let e,t,s="Profile page",f,n,d,o,E,I,u,b,c,C="Email",U,r,m,h,k,N,ee="Username",J,P,q,Q,B,M,te="Caption",W,V,F,X,O,A,G,T,Z,ae;function de(p){l[9](p)}let le={supabase:l[2]};return l[6]!==void 0&&(le.url=l[6]),o=new Ae({props:le}),oe.push(()=>ye(o,"url",de)),o.$on("upload",l[10]),{c(){e=v("div"),t=v("h1"),t.textContent=s,f=D(),n=v("form"),d=v("div"),Ee(o.$$.fragment),I=D(),u=v("div"),b=v("div"),c=v("label"),c.textContent=C,U=D(),r=v("input"),h=D(),k=v("div"),N=v("label"),N.textContent=ee,J=D(),P=v("input"),Q=D(),B=v("div"),M=v("label"),M.textContent=te,W=D(),V=v("input"),X=D(),O=v("div"),A=v("input"),this.h()},l(p){e=_(p,"DIV",{class:!0});var g=L(e);t=_(g,"H1",{"data-svelte-h":!0}),x(t)!=="svelte-18kfhmw"&&(t.textContent=s),f=w(g),n=_(g,"FORM",{class:!0,method:!0,action:!0});var z=L(n);d=_(z,"DIV",{class:!0});var S=L(d);Ie(o.$$.fragment,S),I=w(S),u=_(S,"DIV",{class:!0});var j=L(u);b=_(j,"DIV",{class:!0});var H=L(b);c=_(H,"LABEL",{for:!0,"data-svelte-h":!0}),x(c)!=="svelte-1p9d3fm"&&(c.textContent=C),U=w(H),r=_(H,"INPUT",{id:!0,type:!0}),H.forEach(y),h=w(j),k=_(j,"DIV",{class:!0});var K=L(k);N=_(K,"LABEL",{for:!0,"data-svelte-h":!0}),x(N)!=="svelte-1wr0xay"&&(N.textContent=ee),J=w(K),P=_(K,"INPUT",{id:!0,name:!0,type:!0}),K.forEach(y),Q=w(j),B=_(j,"DIV",{class:!0});var R=L(B);M=_(R,"LABEL",{for:!0,"data-svelte-h":!0}),x(M)!=="svelte-11042ud"&&(M.textContent=te),W=w(R),V=_(R,"INPUT",{id:!0,name:!0,type:!0}),R.forEach(y),j.forEach(y),S.forEach(y),X=w(z),O=_(z,"DIV",{});var se=L(O);A=_(se,"INPUT",{type:!0,class:!0}),se.forEach(y),z.forEach(y),g.forEach(y),this.h()},h(){var p,g;a(c,"for","email"),a(r,"id","email"),a(r,"type","text"),r.value=m=(p=l[1])==null?void 0:p.user.email,r.disabled=!0,a(b,"class","single-input svelte-e8h9y1"),a(N,"for","username"),a(P,"id","username"),a(P,"name","username"),a(P,"type","text"),P.value=q=l[3].username,P.disabled=!0,a(k,"class","single-input svelte-e8h9y1"),a(M,"for","profile_text"),a(V,"id","profile_text"),a(V,"name","profile_text"),a(V,"type","text"),V.value=F=((g=l[0])==null?void 0:g.profile_text)??l[3].profile_text,a(B,"class","single-input svelte-e8h9y1"),a(u,"class","text-inputs svelte-e8h9y1"),a(d,"class","editable-section svelte-e8h9y1"),a(A,"type","submit"),a(A,"class","button block primary"),A.value=G=l[4]?"Loading...":"Update",A.disabled=l[4],a(n,"class","center-v svelte-e8h9y1"),a(n,"method","post"),a(n,"action","?/update"),a(e,"class","center-v svelte-e8h9y1")},m(p,g){Y(p,e,g),i(e,t),i(e,f),i(e,n),i(n,d),Ce(o,d,null),i(d,I),i(d,u),i(u,b),i(b,c),i(b,U),i(b,r),i(u,h),i(u,k),i(k,N),i(k,J),i(k,P),i(u,Q),i(u,B),i(B,M),i(B,W),i(B,V),i(n,X),i(n,O),i(O,A),l[11](n),T=!0,Z||(ae=ge(Le.call(null,n,l[7])),Z=!0)},p(p,[g]){var S,j;const z={};g&4&&(z.supabase=p[2]),!E&&g&64&&(E=!0,z.url=p[6],be(()=>E=!1)),o.$set(z),(!T||g&2&&m!==(m=(S=p[1])==null?void 0:S.user.email)&&r.value!==m)&&(r.value=m),(!T||g&8&&q!==(q=p[3].username)&&P.value!==q)&&(P.value=q),(!T||g&9&&F!==(F=((j=p[0])==null?void 0:j.profile_text)??p[3].profile_text)&&V.value!==F)&&(V.value=F),(!T||g&16&&G!==(G=p[4]?"Loading...":"Update"))&&(A.value=G),(!T||g&16)&&(A.disabled=p[4])},i(p){T||(Ue(o.$$.fragment,p),T=!0)},o(p){ke(o.$$.fragment,p),T=!1},d(p){p&&y(e),De(o),l[11](null),Z=!1,ae()}}}function je(l,e,t){let{data:s}=e,{form:f}=e,{session:n,supabase:d,profile:o}=s,E=!1,I,u=o.avatar_url??"";const b=()=>(t(4,E=!0),async()=>{t(4,E=!1)});function c(r){u=r,t(6,u)}const C=()=>{I.requestSubmit()};function U(r){oe[r?"unshift":"push"](()=>{I=r,t(5,I)})}return l.$$set=r=>{"data"in r&&t(8,s=r.data),"form"in r&&t(0,f=r.form)},l.$$.update=()=>{l.$$.dirty&256&&t(1,{session:n,supabase:d,profile:o}=s,n,(t(2,d),t(8,s)),(t(3,o),t(8,s)))},[f,n,d,o,E,I,u,b,s,c,C,U]}class Se extends fe{constructor(e){super(),ce(this,e,je,Te,ue,{data:8,form:0})}}export{Se as component};
